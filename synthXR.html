<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Synth XR - Advanced Web Synthesizer</title>

    <link rel="apple-touch-icon" sizes="180x180" href="./icons/apple-touch-icon.png">
    <meta name="apple-mobile-web-app-title" content="Synth XR">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">

    <!-- Standard Favicons -->
    <link rel="icon" type="image/png" sizes="32x32" href="./icons/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="./icons/favicon-16x16.png">
    <meta name="theme-color" content="#6200ea">
    
    <link rel="stylesheet" href="css/styles.css">
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/tone/14.8.49/Tone.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <script type="module">
        import { builtInPresets } from './js/presets.js';
        window.builtInPresets = builtInPresets;
    </script>    
</head>
<body>
    <div class="synth-container">
        <div class="brand">
            <div class="brand-name">Synth XR</div>
            <img height="35" src="https://avatars.githubusercontent.com/u/11019186?s=200&v=4" alt="Synth XR Logo" class="brand-logo">
        </div>
        
        <div class="master-controls">
            <button class="master-button" id="nudgeButton">
                <i class="fas fa-random"></i>
                <span>Nudge</span>
            </button>
            <button class="master-button" id="chaosButton">
                <i class="fas fa-bolt"></i>
                <span>Chaos</span>
            </button>
            
            <div class="spacer"></div>
            
            <button class="master-button" id="initPatchButton">
                <i class="fas fa-undo"></i>
                <span>Init Patch</span>
            </button>
        </div>
        
        <div class="main-modules-1">
            <div class="module oscillator-module">
                <div class="module-header">
                    <h3 class="module-title">
                        <i class="fas fa-wave-square"></i>
                        Oscillator
                    </h3>
                    <button class="module-collapse-btn" title="Collapse module">
                        <i class="fas fa-chevron-up"></i>
                    </button>
                </div>
                <div class="control-group">
                    <div class="select-container">
                        <label class="select-label">Waveform</label>
                        <select id="waveform">
                            <option value="sine">Sine</option>
                            <option value="square">Square</option>
                            <option value="sawtooth">Sawtooth</option>
                            <option value="triangle">Triangle</option>
                            <option value="pulse">Pulse</option>
                            <option value="fmsine">FM Sine</option>
                            <!-- <option value="amsine">AM Sine</option>
                            <option value="fatsawtooth">Fat Saw</option>
                            <option value="fatsquare" selected>Fat Square</option> -->
                        </select>
                    </div>
                    <!-- Pulse Width control - hidden by default -->
                    <div class="knob-container" id="pulseWidthContainer" style="display: none;">
                        <label class="knob-label">Pulse Width</label>
                        <div class="knob" id="pulseWidthKnob">
                            <div class="knob-inner"></div>
                            <div class="tooltip">Adjust pulse width</div>
                        </div>
                        <input type="range" id="pulseWidth" min="0.05" max="0.95" step="0.01" value="0.5">
                        <span class="knob-value" id="pulseWidthValue">0.50</span>
                    </div>
                    <!-- FM Sine controls - hidden by default -->
                    <div class="knob-container" id="harmonicityContainer" style="display: none;">
                        <label class="knob-label">Harmonicity</label>
                        <div class="knob" id="harmonicityKnob">
                            <div class="knob-inner"></div>
                            <div class="tooltip">Adjust harmonicity ratio</div>
                        </div>
                        <input type="range" id="harmonicity" min="0.1" max="10" step="0.1" value="1">
                        <span class="knob-value" id="harmonicityValue">1.0</span>
                    </div>
                    <div class="knob-container" id="modulationIndexContainer" style="display: none;">
                        <label class="knob-label">Mod Index</label>
                        <div class="knob" id="modulationIndexKnob">
                            <div class="knob-inner"></div>
                            <div class="tooltip">Adjust modulation amount</div>
                        </div>
                        <input type="range" id="modulationIndex" min="0" max="50" step="0.1" value="10">
                        <span class="knob-value" id="modulationIndexValue">10.0</span>
                    </div>
                </div>
                <div class="control-group">
                    <div class="knob-container">
                        <label class="knob-label">Tempo</label>
                        <div class="knob" id="tempoKnob">
                            <div class="knob-inner"></div>
                            <div class="tooltip">Adjust tempo</div>
                        </div>
                        <input type="range" id="tempo" min="60" max="200" value="120">
                        <span class="knob-value" id="tempoValue">120 BPM</span>
                    </div>
                </div>
                <!-- New control group for octave, semi, and level knobs -->
                <div class="control-group">
                    <div class="knob-container">
                        <label class="knob-label">Octave</label>
                        <div class="knob" id="oscillatorOctaveKnob">
                            <div class="knob-inner"></div>
                            <div class="tooltip">Adjust octave</div>
                        </div>
                        <input type="range" id="oscillatorOctave" min="-2" max="2" step="1" value="0">
                        <span class="knob-value" id="oscillatorOctaveValue">0</span>
                    </div>
                    <div class="knob-container">
                        <label class="knob-label">Semi</label>
                        <div class="knob" id="oscillatorSemiKnob">
                            <div class="knob-inner"></div>
                            <div class="tooltip">Adjust detune in semitones</div>
                        </div>
                        <input type="range" id="oscillatorSemi" min="-12" max="12" step="1" value="0">
                        <span class="knob-value" id="oscillatorSemiValue">0</span>
                    </div>
                    <div class="knob-container">
                        <label class="knob-label">Level</label>
                        <div class="knob" id="oscillatorLevelKnob">
                            <div class="knob-inner"></div>
                            <div class="tooltip">Adjust oscillator volume</div>
                        </div>
                        <input type="range" id="oscillatorLevel" min="0" max="1" step="0.01" value="0.8">
                        <span class="knob-value" id="oscillatorLevelValue">0.80</span>
                    </div>
                </div>
                <div class="control-group">
                    <div class="knob-container">
                        <label class="knob-label">Detune</label>
                        <div class="knob" id="detuneKnob">
                            <div class="knob-inner"></div>
                            <div class="tooltip">Adjust oscillator detune</div>
                        </div>
                        <input type="range" id="detune" min="-100" max="100" step="1" value="0">
                        <span class="knob-value" id="detuneValue">0 Â¢</span>
                    </div>
                    <div class="knob-container">
                        <label class="knob-label">Voices</label>
                        <div class="knob" id="voicesKnob">
                            <div class="knob-inner"></div>
                            <div class="tooltip">Adjust number of voices</div>
                        </div>
                        <input type="range" id="voices" min="1" max="16" step="1" value="16">
                        <span class="knob-value" id="voicesValue">16</span>
                    </div>
                </div>
            </div>
            
            <div class="module filter-module">
                <div class="module-header">
                    <h3 class="module-title">
                        <i class="fas fa-filter"></i>
                        Filter
                    </h3>
                </div>
                <div class="control-group">
                    <!-- Added filter type toggle -->
                    <div class="toggle-container">
                        <label class="toggle-label">Filter Type</label>
                        <label class="toggle-switch">
                            <input type="checkbox" id="filterTypeToggle">
                            <span class="toggle-slider"></span>
                        </label>
                        <div class="toggle-state" id="filterTypeState">LP</div>
                    </div>
                </div>
                <div class="control-group">
                    <div class="knob-container">
                        <label class="knob-label">Cutoff</label>
                        <div class="knob" id="filterCutoffKnob">
                            <div class="knob-inner"></div>
                            <div class="tooltip">Adjust filter cutoff frequency</div>
                        </div>
                        <input type="range" id="filterCutoff" min="20" max="20000" value="2000">
                        <span class="knob-value" id="filterCutoffValue">2000 Hz</span>
                        
                        <!-- Add fine control slider for low frequencies -->
                        <div class="fine-control-container">
                            <input type="range" id="filterCutoffLow" min="20" max="1000" value="200" class="fine-control-slider">
                            <span class="fine-control-label">Low-End Focus</span>
                        </div>
                    </div>
                    <div class="knob-container">
                        <label class="knob-label">Resonance</label>
                        <div class="knob" id="filterResKnob">
                            <div class="knob-inner"></div>
                            <div class="tooltip">Adjust filter resonance</div>
                        </div>
                        <input type="range" id="filterRes" min="0" max="20" value="1">
                        <span class="knob-value" id="filterResValue">1</span>
                        </div>
                    </div>
                    
                    <!-- Add Filter Response Curve -->
                    <div class="filter-response">
                        <svg id="filterResponseSvg" width="100%" height="100%">
                            <defs>
                                <linearGradient id="filterGradient" x1="0%" y1="0%" x2="0%" y2="100%">
                                    <stop offset="0%" stop-color="rgba(0, 229, 255, 0.3)" />
                                    <stop offset="100%" stop-color="rgba(0, 229, 255, 0)" />
                                </linearGradient>
                            </defs>
                            <path id="filterCurve" class="filter-curve" d="M0,50 L400,50" />
                            <path id="filterArea" class="filter-area" d="M0,70 L400,70 L400,50 L0,50 Z" fill="url(#filterGradient)" />
                        </svg>
                    </div>
                </div>
                
                <div class="module effects-module">
                    <div class="module-header">
                        <h3 class="module-title">
                            <i class="fas fa-magic"></i>
                            Effects
                        </h3>
                    </div>
                        <!-- Reverb group with dotted border -->
                        <div class="effect-group">
                            <div class="effect-group-label">
                                <i class="fas fa-mountain"></i>
                                Reverb
                            </div>
                            <div class="control-group">
                                <div class="knob-container">
                                    <label class="knob-label">Mix</label>
                                    <div class="knob" id="reverbMixKnob">
                                        <div class="knob-inner"></div>
                                        <div class="tooltip">Adjust reverb mix</div>
                                    </div>
                                    <input type="range" id="reverbMix" min="0" max="1" step="0.01" value="0.3">
                                    <span class="knob-value" id="reverbMixValue">0.30</span>
                                </div>
                                <!-- New reverb decay knob -->
                                <div class="knob-container">
                                    <label class="knob-label">Decay</label>
                                    <div class="knob" id="reverbDecayKnob">
                                        <div class="knob-inner"></div>
                                        <div class="tooltip">Adjust reverb decay/tail</div>
                                    </div>
                                    <input type="range" id="reverbDecay" min="0.1" max="10" step="0.1" value="2">
                                    <span class="knob-value" id="reverbDecayValue">2.0s</span>
                                </div>
                            </div>
                        
                        <!-- Delay group with dotted border -->
                        <div class="effect-group">
                            <div class="effect-group-label">
                                <i class="fas fa-clock"></i>
                                Delay
                            </div>
                            <div class="control-group">
                                <div class="knob-container">
                                    <label class="knob-label">Time</label>
                                    <div class="knob" id="delayTimeKnob">
                                        <div class="knob-inner"></div>
                                        <div class="tooltip">Adjust delay time</div>
                                    </div>
                                    <input type="range" id="delayTime" min="0" max="1" step="0.01" value="0.3">
                                    <span class="knob-value" id="delayTimeValue">0.30</span>
                                </div>
                                <div class="knob-container">
                                    <label class="knob-label">Feedback</label>
                                    <div class="knob" id="delayFeedbackKnob">
                                        <div class="knob-inner"></div>
                                        <div class="tooltip">Adjust delay feedback</div>
                                    </div>
                                    <input type="range" id="delayFeedback" min="0" max="0.9" step="0.01" value="0.4">
                                    <span class="knob-value" id="delayFeedbackValue">0.40</span>
                                </div>
                            </div>
                        </div>
                        
                        <!-- New effects sections -->
                        <div class="effect-group">
                            <div class="effect-group-label">
                                <i class="fas fa-wave-square"></i>
                                Modulation
                            </div>
                            <div class="control-group">
                                <div class="knob-container">
                                    <label class="knob-label">Chorus</label>
                                    <div class="knob" id="chorusMixKnob">
                                        <div class="knob-inner"></div>
                                        <div class="tooltip">Adjust chorus mix</div>
                                    </div>
                                    <input type="range" id="chorusMix" min="0" max="1" step="0.01" value="0">
                                    <span class="knob-value" id="chorusMixValue">0.00</span>
                                </div>
                                <div class="knob-container">
                                    <label class="knob-label">Flanger</label>
                                    <div class="knob" id="flangerMixKnob">
                                        <div class="knob-inner"></div>
                                        <div class="tooltip">Adjust flanger mix</div>
                                    </div>
                                    <input type="range" id="flangerMix" min="0" max="1" step="0.01" value="0">
                                    <span class="knob-value" id="flangerMixValue">0.00</span>
                                </div>
                            </div>
                        </div>
                        
                        <div class="effect-group">
                            <div class="effect-group-label">
                                <i class="fas fa-bolt"></i>
                                Character
                            </div>
                            <div class="control-group">
                                <div class="knob-container">
                                    <label class="knob-label">Distortion</label>
                                    <div class="knob" id="distortionMixKnob">
                                        <div class="knob-inner"></div>
                                        <div class="tooltip">Adjust distortion amount</div>
                                    </div>
                                    <input type="range" id="distortionMix" min="0" max="1" step="0.01" value="0">
                                    <span class="knob-value" id="distortionMixValue">0.00</span>
                                </div>
                                <div class="knob-container">
                                    <label class="knob-label">Phaser</label>
                                    <div class="knob" id="phaserMixKnob">
                                        <div class="knob-inner"></div>
                                        <div class="tooltip">Adjust phaser mix</div>
                                    </div>
                                    <input type="range" id="phaserMix" min="0" max="1" step="0.01" value="0">
                                    <span class="knob-value" id="phaserMixValue">0.00</span>
                                </div>
                            </div>
                        </div>
                    </div>                
                </div>
            </div>
    
            <div class="main-modules-2">
                <div class="module adsr-module">
                    <div class="module-header">
                        <h3 class="module-title">
                            <i class="fas fa-sliders-h"></i>
                            Envelope (ADSR)
                        </h3>
                    </div>
                    <div class="control-group">
                        <div class="knob-container">
                            <label class="knob-label">Attack</label>
                            <div class="knob" id="attackKnob">
                                <div class="knob-inner"></div>
                                <div class="tooltip">Adjust attack time</div>
                            </div>
                            <input type="range" id="attack" min="0" max="12" step="0.01" value="0.1">
                            <span class="knob-value" id="attackValue">0.10s</span>
                        </div>
                        <div class="knob-container">
                            <label class="knob-label">Decay</label>
                            <div class="knob" id="decayKnob">
                                <div class="knob-inner"></div>
                                <div class="tooltip">Adjust decay time</div>
                            </div>
                            <input type="range" id="decay" min="0" max="12" step="0.01" value="0.2">
                            <span class="knob-value" id="decayValue">0.20s</span>
                        </div>
                        <div class="knob-container">
                            <label class="knob-label">Sustain</label>
                            <div class="knob" id="sustainKnob">
                                <div class="knob-inner"></div>
                                <div class="tooltip">Adjust sustain level</div>
                            </div>
                            <input type="range" id="sustain" min="0" max="1" step="0.01" value="0.5">
                            <span class="knob-value" id="sustainValue">0.50</span>
                        </div>
                        <div class="knob-container">
                            <label class="knob-label">Release</label>
                            <div class="knob" id="releaseKnob">
                                <div class="knob-inner"></div>
                                <div class="tooltip">Adjust release time</div>
                            </div>
                            <input type="range" id="release" min="0" max="12" step="0.01" value="0.5">
                            <span class="knob-value" id="releaseValue">0.50s</span>
                        </div>
                    </div>
                    
                    <!-- Add ADSR Envelope Visualizer -->
                    <div class="adsr-visualizer">
                        <svg id="adsrVisualizerSvg" width="100%" height="100%">
                            <path id="adsrPath" class="adsr-path" d="M0,70 L0,70" />
                        </svg>
                        <div id="adsrMarker" class="adsr-marker" style="display: none;"></div>
                    </div>
                </div>
                
                <div class="module eq-module">
                    <div class="module-header">
                        <h3 class="module-title">
                            <i class="fas fa-sliders-h"></i>
                            Equalizer
                        </h3>
                    </div>
                    <div class="control-group">
                        <div class="knob-container">
                            <label class="knob-label">Low</label>
                            <div class="knob" id="eqLowKnob">
                                <div class="knob-inner"></div>
                                <div class="tooltip">Adjust low frequency gain</div>
                            </div>
                            <input type="range" id="eqLow" min="-12" max="12" value="0" step="0.5">
                            <span class="knob-value" id="eqLowValue">0 dB</span>
                        </div>
                        <div class="knob-container">
                            <label class="knob-label">Mid</label>
                            <div class="knob" id="eqMidKnob">
                                <div class="knob-inner"></div>
                                <div class="tooltip">Adjust mid frequency gain</div>
                            </div>
                            <input type="range" id="eqMid" min="-12" max="12" value="0" step="0.5">
                            <span class="knob-value" id="eqMidValue">0 dB</span>
                        </div>
                        <div class="knob-container">
                            <label class="knob-label">High</label>
                            <div class="knob" id="eqHighKnob">
                                <div class="knob-inner"></div>
                                <div class="tooltip">Adjust high frequency gain</div>
                            </div>
                            <input type="range" id="eqHigh" min="-12" max="12" value="0" step="0.5">
                            <span class="knob-value" id="eqHighValue">0 dB</span>
                        </div>
                    </div>
                    <div class="control-group">
                        <div class="knob-container">
                            <label class="knob-label">Mid Freq</label>
                            <div class="knob" id="eqMidFreqKnob">
                                <div class="knob-inner"></div>
                                <div class="tooltip">Adjust mid frequency center</div>
                            </div>
                            <input type="range" id="eqMidFreq" min="200" max="5000" value="1000" step="50">
                            <span class="knob-value" id="eqMidFreqValue">1000 Hz</span>
                        </div>
                        <div class="knob-container">
                            <label class="knob-label">Q</label>
                            <div class="knob" id="eqQKnob">
                                <div class="knob-inner"></div>
                                <div class="tooltip">Adjust Q factor (bandwidth)</div>
                            </div>
                            <input type="range" id="eqQ" min="0.1" max="5" value="1" step="0.1">
                            <span class="knob-value" id="eqQValue">1.0</span>
                        </div>
                    </div>
                    
                    <!-- Improved EQ Response Curve Visualization -->
                    <div class="eq-response">
                        <svg id="eqResponseSvg" width="100%" height="100%">
                            <defs>
                                <linearGradient id="eqGradient" x1="0%" y1="0%" x2="0%" y2="100%">
                                    <stop offset="0%" stop-color="rgba(0, 229, 255, 0.4)" />
                                    <stop offset="50%" stop-color="rgba(157, 70, 255, 0.2)" />
                                    <stop offset="100%" stop-color="rgba(157, 70, 255, 0)" />
                                </linearGradient>
                            </defs>
                            <!-- Grid lines will be added by JS -->
                            <g id="eqGrid"></g>
                            <!-- Zero dB reference line -->
                            <line id="eqZeroLine" class="eq-zero-line" x1="0" y1="50%" x2="100%" y2="50%"></line>
                            <!-- Frequency labels will be added by JS -->
                            <g id="eqLabels"></g>
                            <!-- Mid frequency marker -->
                            <line id="eqMidMarker" class="eq-mid-marker" x1="50%" y1="0" x2="50%" y2="100%"></line>
                            <!-- The EQ curve and area -->
                            <path id="eqArea" class="eq-area" d="M0,50 L100,50 L100,50 L0,50 Z" fill="url(#eqGradient)" />
                            <path id="eqCurve" class="eq-curve" d="M0,50 L100,50" />
                        </svg>
                    </div>
                </div>
    
                <div class="module drone-module">
                    <div class="module-header">
                        <h3 class="module-title">
                            <i class="fas fa-broadcast-tower"></i>
                            Drone Generator
                        </h3>
                    </div>
                    <div class="control-group">
                        <div class="select-container">
                            <label class="select-label">Drone Type</label>
                            <select id="droneType">
                                <option value="oscillator">Oscillator</option>
                                <option value="white">White Noise</option>
                                <option value="pink">Pink Noise</option>
                            </select>
                        </div>
                        <div class="knob-container">
                            <label class="knob-label">Sub Range</label>
                            <div class="knob" id="droneOctaveKnob">
                                <div class="knob-inner"></div>
                                <div class="tooltip">Adjust drone octave</div>
                            </div>
                            <input type="range" id="droneOctave" min="-3" max="0" step="1" value="-1">
                            <span class="knob-value" id="droneOctaveValue">-1</span>
                        </div>
                        <div class="knob-container">
                            <label class="knob-label">Volume</label>
                            <div class="knob" id="droneVolumeKnob">
                                <div class="knob-inner"></div>
                                <div class="tooltip">Adjust drone volume</div>
                            </div>
                            <input type="range" id="droneVolume" min="0" max="1" step="0.01" value="0.8">
                            <span class="knob-value" id="droneVolumeValue">0.80</span>
                        </div>
                        <button class="drone-button" id="droneButton">
                            <i class="fas fa-power-off"></i>
                            <span>Start Drone</span>
                        </button>
                    </div>
                    <div class="drone-visualizer">
                        <div class="drone-wave" id="droneWave">
                            <span></span>
                            <span></span>
                            <span></span>
                            <span></span>
                            <span></span>
                        </div>
                    </div>
                </div>

                
                <!-- Quick Chord Module -->
                <div class="module quick-chord-module">
                    <div class="module-header">
                        <h3 class="module-title">
                            <i class="fas fa-music"></i>
                            Quick Chord
                        </h3>
                        <!-- Add octave pagination in the header -->
                        <div class="octave-pagination">
                            <button class="octave-page-btn" id="decreaseOctave" title="Lower Octave (Z key)">
                                <i class="fas fa-minus"></i>
                            </button>
                            <span class="octave-page-display" id="currentOctave">C4</span>
                            <button class="octave-page-btn" id="increaseOctave" title="Raise Octave (X key)">
                                <i class="fas fa-plus"></i>
                            </button>
                        </div>
                    </div>
                    <div class="chord-controls-container">
                        <div class="chord-controls">
                            <div class="button-group-label">Chord Type</div>
                            <div class="chord-buttons">
                                <button class="chord-button" data-chord-type="maj">Maj</button>
                                <button class="chord-button" data-chord-type="min">Min</button>
                                <button class="chord-button" data-chord-type="dim">Dim</button>
                                <button class="chord-button" data-chord-type="aug">Aug</button>
                                <button class="chord-button" data-chord-type="maj7">Maj7</button>
                                <button class="chord-button" data-chord-type="min7">Min7</button>
                                <button class="chord-button" data-chord-type="dom7">Dom7</button>
                                <button class="chord-button" data-chord-type="maj9">Maj9</button>
                            </div>
                            <div class="button-group-label">Root Note</div>
                            <div class="note-buttons">
                                <button class="note-button" data-note="C">C</button>
                                <button class="note-button" data-note="C#">C#</button>
                                <button class="note-button" data-note="D">D</button>
                                <button class="note-button" data-note="D#">D#</button>
                                <button class="note-button" data-note="E">E</button>
                                <button class="note-button" data-note="F">F</button>
                                <button class="note-button" data-note="F#">F#</button>
                                <button class="note-button" data-note="G">G</button>
                                <button class="note-button" data-note="G#">G#</button>
                                <button class="note-button" data-note="A">A</button>
                                <button class="note-button" data-note="A#">A#</button>
                                <button class="note-button" data-note="B">B</button>
                            </div>
                        </div>
                        
                        <!-- Removed the previous octave counter since we now have it in the header -->
                    </div>
                </div>

                <!-- Arpeggiator Module - Place after Quick Chord module -->
                <div class="module arpeggiator-module">
                    <div class="module-header">
                        <h2 class="module-title"><i class="fas fa-stream"></i> ARPEGGIATOR</h2>
                        <button class="module-collapse-btn" title="Collapse module">
                            <i class="fas fa-chevron-up"></i>
                        </button>
                    </div>
                    <div class="control-group">
                        <!-- Toggle switch for enabling/disabling -->
                        <div class="toggle-container">
                            <label class="toggle-label">ENABLE</label>
                            <label class="toggle-switch">
                                <input type="checkbox" id="arpEnabled">
                                <span class="toggle-slider"></span>
                            </label>
                            <div class="toggle-state" id="arpEnabledState">OFF</div>
                        </div>
                        
                        <!-- Rate knob -->
                        <div class="knob-container">
                            <label class="knob-label">RATE</label>
                            <div class="knob" id="arpRateKnob">
                                <div class="knob-inner"></div>
                            </div>
                            <div class="knob-value" id="arpRateValue">120 BPM</div>
                            <input type="range" id="arpRate" min="60" max="240" value="120" step="1">
                        </div>
                        
                        <!-- Direction select -->
                        <div class="select-container">
                            <label class="select-label">DIRECTION</label>
                            <select id="arpDirection">
                                <option value="up">Up</option>
                                <option value="down">Down</option>
                                <option value="upDown">Up & Down</option>
                                <option value="downUp">Down & Up</option>
                                <option value="random">Random</option>
                            </select>
                        </div>
                        
                        <!-- Gate Length knob -->
                        <div class="knob-container">
                            <label class="knob-label">GATE</label>
                            <div class="knob" id="arpGateKnob">
                                <div class="knob-inner"></div>
                            </div>
                            <div class="knob-value" id="arpGateValue">50%</div>
                            <input type="range" id="arpGate" min="10" max="100" value="50" step="1">
                        </div>

                        <!-- Swing knob -->
                        <div class="knob-container">
                            <label class="knob-label">SWING</label>
                            <div class="knob" id="arpSwingKnob">
                                <div class="knob-inner"></div>
                            </div>
                            <div class="knob-value" id="arpSwingValue">0%</div>
                            <input type="range" id="arpSwing" min="0" max="100" value="0" step="1">
                        </div>                        
                    </div>
                </div>                
            </div>
    
            <div class="visualization">
                <div class="module preset-module">
                    <div class="module-header">
                        <h3 class="module-title">
                            <i class="fas fa-bookmark"></i>
                            Presets
                        </h3>
                    </div>
                    <div class="preset-list" id="presetList">
                        <!-- Presets will be generated by JavaScript -->
                    </div>
                    <div class="preset-actions">
                        <button id="newPresetBtn">
                            <i class="fas fa-plus"></i>
                            <span>New</span>
                        </button>
                        <button id="deletePresetBtn">
                            <i class="fas fa-trash-alt"></i>
                            <span>Delete</span>
                        </button>
                    </div>
                </div>
                
                <div class="module lfo-module">
                    <div class="module-header">
                        <h3 class="module-title">
                            <i class="fas fa-sync-alt"></i>
                            LFO
                        </h3>
                    </div>
                    <div class="control-group">
                        <div class="select-container">
                            <label class="select-label">Waveform</label>
                            <select id="lfoWaveform">
                                <option value="sine">Sine</option>
                                <option value="triangle">Triangle</option>
                                <option value="square">Square</option>
                                <option value="sawtooth">Sawtooth</option>
                                <option value="random">Random</option>
                            </select>
                        </div>
                        <div class="select-container">
                            <label class="select-label">Destination</label>
                            <select id="lfoDestination">
                                <!-- LFO Control -->
                                <option value="off" selected>Off</option>
                                
                                <optgroup label="Oscillator">
                                    <option value="oscillatorLevel">Oscillator Level</option>
                                    <option value="detune">Detune</option>
                                    <option value="pulseWidth">Pulse Width</option>
                                    <option value="harmonicity">Harmonicity</option>
                                    <option value="modulationIndex">Mod Index</option>
                                </optgroup>
                                
                                <optgroup label="Filter">
                                    <option value="filterCutoff">Filter Cutoff</option>
                                    <option value="filterRes">Filter Resonance</option>
                                </optgroup>
                                
                                <optgroup label="ADSR">
                                    <option value="attack">Attack Time</option>
                                    <option value="decay">Decay Time</option>
                                    <option value="sustain">Sustain Level</option>
                                    <option value="release">Release Time</option>
                                </optgroup>
                                
                                <optgroup label="EQ">
                                    <option value="eqLow">EQ Low</option>
                                    <option value="eqMid">EQ Mid</option>
                                    <option value="eqHigh">EQ High</option>
                                    <option value="eqMidFreq">EQ Mid Freq</option>
                                    <option value="eqQ">EQ Q</option>
                                </optgroup>
                                
                                <optgroup label="Time-Based Effects">
                                    <option value="reverbMix">Reverb Mix</option>
                                    <option value="reverbDecay">Reverb Decay</option>
                                    <option value="delayTime">Delay Time</option>
                                    <option value="delayFeedback">Delay Feedback</option>
                                </optgroup>
                                
                                <optgroup label="Modulation Effects">
                                    <option value="chorusMix">Chorus Mix</option>
                                    <option value="flangerMix">Flanger Mix</option>
                                    <option value="phaserMix">Phaser Mix</option>
                                    <option value="distortionMix">Distortion</option>
                                </optgroup>
                                
                                <optgroup label="Master">
                                    <option value="masterVolume">Main Volume</option>
                                    <option value="masterPan">Stereo Pan</option>
                                    <option value="stereoWidth">Stereo Width</option>
                                </optgroup>
                            </select>
                        </div>
                    </div>
                    <div class="control-group">
                        <div class="knob-container">
                            <label class="knob-label">Rate</label>
                            <div class="knob" id="lfoRateKnob">
                                <div class="knob-inner"></div>
                                <div class="tooltip">Adjust LFO speed</div>
                            </div>
                            <input type="range" id="lfoRate" min="0.01" max="5" step="0.01" value="0.5">
                            <span class="knob-value" id="lfoRateValue">1.0 Hz</span>
                        </div>
                        <div class="knob-container">
                            <label class="knob-label">Amount</label>
                            <div class="knob" id="lfoAmountKnob">
                                <div class="knob-inner"></div>
                                <div class="tooltip">Adjust modulation amount</div>
                            </div>
                            <input type="range" id="lfoAmount" min="0" max="100" value="50">
                            <span class="knob-value" id="lfoAmountValue">50%</span>
                        </div>
                    </div>
                    
                    <!-- Just show the basic LFO scope -->
                    <div class="lfo-scope">
                        <canvas id="lfoScope" width="100%" height="80"></canvas>
                    </div>
                </div>
                
                <div class="module oscilloscope-module">
                    <div class="module-header">
                        <h3 class="module-title">
                            <i class="fas fa-chart-line"></i>
                            Oscilloscope
                        </h3>
                    </div>
                    <div class="oscilloscope">
                        <div class="oscilloscope-grid"></div>
                        <canvas id="oscilloscope"></canvas>
                    </div>
                    <div class="vu-meter">
                        <div class="vu-meter-fill" id="vuMeter"></div>
                    </div>
                </div>
                
                <!-- Mastering Module -->
                <div class="module mastering-module">
                    <div class="module-header">
                        <h3 class="module-title">
                            <i class="fas fa-sliders-h"></i>
                            Mastering
                        </h3>
                    </div>
                    <div class="compact-controls">
                        <div class="small-knob-container">
                            <label class="knob-label">Volume</label>
                            <div class="small-knob" id="masterVolumeKnob">
                                <div class="small-knob-inner"></div>
                            </div>
                            <input type="range" id="masterVolume" min="0" max="2" step="0.01" value="0.25">
                            <span class="knob-value" id="masterVolumeValue">0.25</span>
                        </div>
                        <div class="small-knob-container">
                            <label class="knob-label">Pan</label>
                            <div class="small-knob" id="masterPanKnob">
                                <div class="small-knob-inner"></div>
                            </div>
                            <input type="range" id="masterPan" min="-1" max="1" step="0.01" value="0">
                            <span class="knob-value" id="masterPanValue">C</span>
                        </div>
                        <div class="small-knob-container">
                            <label class="knob-label">Width</label>
                            <div class="small-knob" id="stereoWidthKnob">
                                <div class="small-knob-inner"></div>
                            </div>
                            <input type="range" id="stereoWidth" min="0" max="1" step="0.01" value="0.5">
                            <span class="knob-value" id="stereoWidthValue">0.50</span>
                        </div>
                        <div class="small-knob-container">
                            <label class="knob-label">Comp</label>
                            <div class="small-knob" id="compressorKnob">
                                <div class="small-knob-inner"></div>
                            </div>
                            <input type="range" id="compressor" min="0" max="1" step="0.01" value="0">
                            <span class="knob-value" id="compressorValue">0.00</span>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="module sequencer-container">
                <div class="module-header">
                    <h3 class="module-title">
                        <i class="fas fa-step-forward"></i>
                        Sequencer
    
                        <button class="master-button" id="startSequencer">
                            <i class="fas fa-play"></i>
                            <span>Start</span>
                        </button>
            
                    </h3>
                </div>
                <div class="sequencer" id="sequencer">
                    <!-- Steps will be generated by JavaScript -->
                </div>
                <div class="keyboard" id="keyboard">
                    <!-- Keys will be generated by JavaScript -->
                </div>
            </div>
    
            <!-- New Drum Pad Module -->
            <div class="module drum-pad-module">
                <div class="module-header">
                    <h3 class="module-title">
                        <i class="fas fa-drum"></i>
                        Drum Pads
                    </h3>
                </div>
                <div class="drum-pads-container">
                    <div class="drum-pads-grid">
                        <div class="drum-pad" data-sound="kick">
                            <span class="drum-pad-label">Kick</span>
                            <input type="range" id="kickVolume" class="drum-volume-range" min="0" max="1" step="0.01" value="0.8">
                        </div>
                        <div class="drum-pad" data-sound="snare">
                            <span class="drum-pad-label">Snare</span>
                            <input type="range" id="snareVolume" class="drum-volume-range" min="0" max="1" step="0.01" value="0.7">
                        </div>
                        <div class="drum-pad" data-sound="hihat">
                            <span class="drum-pad-label">Hi-hat</span>
                            <input type="range" id="hihatVolume" class="drum-volume-range" min="0" max="1" step="0.01" value="0.6">
                        </div>
                        <div class="drum-pad" data-sound="clap">
                            <span class="drum-pad-label">Clap</span>
                            <input type="range" id="clapVolume" class="drum-volume-range" min="0" max="1" step="0.01" value="0.65">
                        </div>
                        <div class="drum-pad" data-sound="tom">
                            <span class="drum-pad-label">Tom</span>
                            <input type="range" id="tomVolume" class="drum-volume-range" min="0" max="1" step="0.01" value="0.7">
                        </div>
                        <div class="drum-pad" data-sound="rimshot">
                            <span class="drum-pad-label">Rim</span>
                            <input type="range" id="rimshotVolume" class="drum-volume-range" min="0" max="1" step="0.01" value="0.7">
                        </div>
                        <div class="drum-pad" data-sound="cowbell">
                            <span class="drum-pad-label">Cowbell</span>
                            <input type="range" id="cowbellVolume" class="drum-volume-range" min="0" max="1" step="0.01" value="0.6">
                        </div>
                        <div class="drum-pad" data-sound="cymbal">
                            <span class="drum-pad-label">Cymbal</span>
                            <input type="range" id="cymbalVolume" class="drum-volume-range" min="0" max="1" step="0.01" value="0.5">
                        </div>
                    </div>
                </div>
            </div>
                
            <div class="advance-visualizer">
                <!-- Toggle for advanced visualizers -->
                <div class="visualizer-toggle" id="visualizerToggle">
                    <i class="fas fa-chevron-down"></i>
                    <span>Show Advanced Visualizations</span>
                </div>
            </div>
        </div>
    
        <!-- Modal for new preset -->
        <div class="modal-overlay" id="presetModal">
            <div class="modal">
                <div class="modal-header">
                    <h3 class="modal-title">Save New Preset</h3>
                </div>
                <div class="modal-body">
                    <label for="presetName">Preset Name</label>
                    <input type="text" id="presetName" class="modal-input" placeholder="Enter a name for your preset">
                    
                    <label for="presetCategory">Category</label>
                    <select id="presetCategory" class="modal-select">
                        <option value="bass">Bass</option>
                        <option value="lead">Lead</option>
                        <option value="pad">Pad</option>
                        <option value="fx">FX</option>
                        <option value="pluck">Pluck</option>
                        <option value="keys">Keys</option>
                        <option value="custom" selected>Custom</option>
                    </select>
                </div>
                <div class="modal-actions">
                    <button class="modal-button cancel" id="cancelPresetBtn">Cancel</button>
                    <button class="modal-button confirm" id="savePresetBtn">Save</button>
                </div>
            </div>
        </div>
    
        <div class="module midi-module">
            <div class="module-header">
                <h3 class="module-title">
                    <i class="fas fa-keyboard"></i>
                    MIDI
                </h3>
                <div id="midiStatusIndicator" class="midi-status-indicator" title="MIDI status">
                    <span></span>
                </div>
            </div>
            <div class="midi-content">
                <div class="midi-controls">
                    <div class="control-group">
                        <div class="midi-section">
                            <label for="midiDeviceSelector">MIDI Device</label>
                            <select id="midiDeviceSelector" class="midi-select">
                                <option value="">-- Select MIDI Device --</option>
                                <!-- Devices will be populated by JavaScript -->
                            </select>
                        </div>
                        
                        <div class="midi-section">
                            <label>MIDI Learn</label>
                            <div class="toggle-switch" id="midiLearnToggle">
                                <div class="toggle-switch-slider"></div>
                            </div>
                            <div class="midi-learn-status">Off</div>
                        </div>
                    </div>
                    
                    <div class="control-group">
                        <div class="midi-mapping-controls">
                            <button id="clearMappingsBtn" class="midi-button">
                                <i class="fas fa-trash-alt"></i>
                                Clear All Mappings
                            </button>
                            <!-- <button id="exportMappingsBtn" class="midi-button">
                                <i class="fas fa-file-export"></i>
                                Export
                            </button>
                            <button id="importMappingsBtn" class="midi-button">
                                <i class="fas fa-file-import"></i>
                                Import
                            </button>
                            <input type="file" id="importMappingsFile" accept=".json" style="display: none"> -->
                        </div>
                    </div>
                </div>
                
                <div class="midi-mappings">
                    <h4 class="midi-section-title">Current Mappings</h4>
                    <div id="midiMappingsList" class="midi-mappings-list">
                        <!-- Mappings will be populated by JavaScript -->
                    </div>
                    <div id="noMappingsMsg" class="no-mappings-msg">
                        No MIDI mappings yet. Enable MIDI Learn mode and move controls on your MIDI device to create mappings.
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Help Modal -->
    <div class="modal-overlay" id="helpModal">
        <div class="modal help-modal">
            <div class="modal-header">
                <h3 class="modal-title"><i class="fas fa-lightbulb"></i> Synth XR Guide</h3>
            </div>
            <div class="modal-body">
                <div class="help-section">
                    <h4><i class="fas fa-keyboard"></i> Keyboard Shortcuts</h4>
                    <div class="help-grid">
                        <div class="help-grid-item">
                            <div class="help-command">
                                <span class="key-combo">A-K, W-U</span>
                                <span class="key-desc">Play white and black keys</span>
                            </div>
                            <div class="help-command">
                                <span class="key-combo">Z / X</span>
                                <span class="key-desc">Decrease / Increase octave</span>
                            </div>
                            <div class="help-command">
                                <span class="key-combo">Space</span>
                                <span class="key-desc">Start/Stop sequencer</span>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="help-section">
                    <h4><i class="fas fa-mobile-alt"></i> iOS Installation</h4>
                    <div class="ios-install-steps">
                        <div class="ios-step">
                            <div class="ios-step-icon"><i class="fas fa-safari"></i></div>
                            <p>Open SynthXR in Safari browser</p>
                        </div>
                        <div class="ios-step">
                            <div class="ios-step-icon"><i class="fas fa-share-square"></i></div>
                            <p>Tap the Share button <span class="ios-note">(box with arrow)</span></p>
                        </div>
                        <div class="ios-step">
                            <div class="ios-step-icon"><i class="fas fa-plus-square"></i></div>
                            <p>Tap "Add to Home Screen"</p>
                        </div>
                        <div class="ios-step">
                            <div class="ios-step-icon"><i class="fas fa-check-circle"></i></div>
                            <p>Name the app and tap "Add"</p>
                        </div>
                    </div>
                </div>
                
                <div class="help-section">
                    <h4><i class="fas fa-star"></i> Pro Tips</h4>
                    <ul class="pro-tips">
                        <li>
                            <i class="fas fa-random"></i>
                            <span>Use "Nudge" for subtle randomization of parameters</span>
                        </li>
                        <li>
                            <i class="fas fa-bolt"></i>
                            <span>Try "Chaos" for wild, experimental sounds</span>
                        </li>
                        <li>
                            <i class="fas fa-save"></i>
                            <span>Save your favorite sounds as presets for later use</span>
                        </li>
                        <li>
                            <i class="fas fa-plug"></i>
                            <span>Connect a MIDI controller for enhanced performance</span>
                        </li>
                        <li>
                            <i class="fas fa-sliders-h"></i>
                            <span>Use the Arpeggiator with chords for complex patterns</span>
                        </li>
                    </ul>
                </div>
                
                <div class="help-section">
                    <h4><i class="fas fa-link"></i> Links</h4>
                    <div class="links-container">
                        <a href="https://github.com/andrewdamelio/Synth-XR/" target="_blank" class="help-link">
                            <i class="fab fa-github"></i> GitHub Repository
                        </a>
                    </div>
                </div>
            </div>
            <div class="modal-actions">
                <button class="modal-button confirm" id="closeHelpBtn">Close</button>
            </div>
        </div>
    </div>

        
    <script type="module" src="js/main.js"></script>
    <script src="js/enhanced-visualizers.js"></script>
</body>
</html>